diff -Nur plague-0.4.5.7-20090612/server/ArchJob.py plague-0.4.5.7-20100505/server/ArchJob.py
--- plague-0.4.5.7-20090612/server/ArchJob.py	2008-01-31 15:18:53.000000000 +0100
+++ plague-0.4.5.7-20100505/server/ArchJob.py	2010-05-05 11:46:46.000000000 +0200
@@ -264,6 +264,7 @@
                                 self.par_job.package, self._target_dict['arch'], self.builder.address(), url, e)
                     # Hard error, we don't retry this one
                     dl_dict[DL_STATUS] = STATUS_ERROR
+                    failed = True
                 break
             elif dl_status == STATUS_INPROGRESS:
                 undownloaded = True
diff -Nur plague-0.4.5.7-20090612/builder/builder.py plague-0.4.5.7-20100505/builder/builder.py
--- plague-0.4.5.7-20090612/builder/builder.py	2010-05-05 13:20:39.000000000 +0200
+++ plague-0.4.5.7-20100505/builder/builder.py	2010-05-05 12:45:20.000000000 +0200
@@ -462,6 +462,8 @@
     def _find_files(self):
         # Grab the list of files in our job's result dir and URL encode them
         files_in_dir = os.listdir(self._result_dir)
+        if 'repodata' in files_in_dir:
+            files_in_dir.remove('repodata')
         file_list = []
         self._log("\n")
         self._log("Output File List:\n")
diff -Nur plague-0.4.5.7-20090612/ChangeLog plague-0.4.5.7-20100505/ChangeLog
--- plague-0.4.5.7-20090612/ChangeLog	2010-05-05 13:20:41.000000000 +0200
+++ plague-0.4.5.7-20100505/ChangeLog	2010-05-05 12:56:03.000000000 +0200
@@ -1,3 +1,13 @@
+2010-05-05  Michael Schwendt <mschwendt@fedoraproject.org>
+
+	* server/ArchJob.py
+	  - Let job fail for FileDownloader.FileNameException errors,
+	    or else it would succeed without having downloaded all files
+	    e.g. if Mock is run with createrepo_on_rpms = True.
+
+	* builder/builder.py
+	  - Always ignore 'repodata' directory in build results dir.
+
 2009-06-12  Michael Schwendt <mschwendt@fedoraproject.org>
 
 	* common/SSLConnection.py
